import 'dart:io';
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:shared_preferences/shared_preferences.dart';

class Secondpage extends StatefulWidget {
  final String email;
  final File? image;

  const Secondpage({super.key, required this.email, this.image});

  @override
  State<Secondpage> createState() => _SecondpageState();
}

class _SecondpageState extends State<Secondpage> {
  List<File> images = [];
  List<String> emails = [];

  @override
  void initState() {
    super.initState();
    GetData();
  }

  Future<void> GetData() async {
    final prefs = await SharedPreferences.getInstance();
    List<String> emailList = prefs.getStringList('emails') ?? [];
    List<String> imagePaths = prefs.getStringList('photos') ?? [];

    // Debug statements
    print("Emails retrieved: $emailList");
    print("Photos retrieved: $imagePaths");

    setState(() {
      emails = emailList;
      images = imagePaths.map((path) => File(path)).toList();
    });

    // Debug statements
    print("Emails after setState: $emails");
    print("Photos after setState: $images");
  }

  @override
  Widget build(BuildContext context) {
    final width = MediaQuery.of(context).size.width;
    return Scaffold(
      appBar: AppBar(),
      body: emails.isEmpty
          ? Center(child: Text("No Data"))
          : ListView.builder(
              itemCount: images.length,
              itemBuilder: (BuildContext context, int index) {
                return Padding(
                  padding: const EdgeInsets.all(20),
                  child: Container(
                    decoration: BoxDecoration(
                      color: Colors.blueGrey.shade100,
                      borderRadius: BorderRadius.circular(20),
                    ),
                    height: 180,
                    width: width,
                    child: Row(
                      children: [
                        SizedBox(
                          width: 20,
                        ),
                        Container(
                          decoration: BoxDecoration(
                            color: Colors.grey,
                            borderRadius: BorderRadius.circular(70),
                          ),
                          height: 80,
                          width: 80,
                          child: images[index] != null
                              ? ClipOval(
                                  child: Image.file(images[index],
                                      fit: BoxFit.cover))
                              : Icon(Icons.person, size: 70),
                        ),
                        SizedBox(
                          width: 20,
                        ),
                        Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            SizedBox(height: 50),
                            Center(
                              child: Text(
                                "Email:  ${emails[index]}",
                                // style: TextStyle(fontSize: 20),
                              ),
                            ),
                            SizedBox(height: 30,),
                            GestureDetector(
                              onTap: () {
                                Get.back();
                              },
                              child: Container(
                                height: 20,
                                width: 80,
                                decoration: BoxDecoration(
                                  color: Colors.deepPurpleAccent,
                                  borderRadius: BorderRadius.circular(14),
                                ),
                                child: Center(
                                  child: Text(
                                    "Edit",
                                   // style: TextStyle(fontSize: 20),
                                  ),
                                ),
                              ),
                            ),
                          ],
                        ),
                      ],
                    ),
                  ),
                );
              },
            ),
    );
  }
}
